<!DOCTYPE html>
<html translate="no">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="Academia Ubuntu Rugby - A formar jovens, dentro e fora de campo desde 2013." />
  <title>Ubuntu Rugby • Notícias</title>

  <link rel="shortcut icon" type="image/x-icon" href="resources/favicon/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="resources/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="resources/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="resources/favicon/favicon-16x16.png">
  <link rel="manifest" href="resources/favicon/site.webmanifest">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous" />

  <link rel="stylesheet" href="resources/css/style.css" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
</head>

<body class="bg-dark">
  <nav class="navbar navbar-expand-sm sticky-top">
    <div class="container">
      <a class="navbar-brand" href="index.html">
        <img src="resources/images/logo1.png" alt="Ubuntu Rugby Logo" width="80" height="80" />
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="bi bi-list fs-1 text-white"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <div class="w-100 d-flex justify-content-center">
          <ul class="navbar-nav fs-5 gap-3">
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="about.html" id="navbarDarkDropdownMenuLink" role="button"
                data-bs-toggle="dropdown" aria-expanded="false">
                Projeto
              </a>
              <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDarkDropdownMenuLink">
                <li><a class="dropdown-item" href="about.html">Sobre nós</a></li>
                <li><a class="dropdown-item" href="values.html">Valores</a></li>
                <li><a class="dropdown-item" href="teams.html">Equipas</a></li>
              </ul>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="training.html">Treinos</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="news.html">Notícias</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="shop.html">Loja</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="partners.html">Sócios</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="contacts.html">Contactos</a>
            </li>
          </ul>
        </div>
        <div class="registration">
          <a class="btn btn-dark btn-brand" href='https://forms.gle/ctQpSjTfFam2us2f8' target="_blank"
            rel="noopener noreferrer">
            INSCRIÇÃO
          </a>
        </div>
      </div>
    </div>
  </nav>

  <div class="container mt-5" data-aos="zoom-in">
    <h2 class="display-5 font-impact text-center">
      NOTÍCIAS
    </h2>

    <div class="search-bar-container mt-4">
      <div class="search-bar mb-3">
        <i class="bi bi-search text-dark"></i> <!-- Bootstrap search icon -->
        <input type="text" id="searchInput" class="form-control" placeholder="Pesquisar notícias...">
      </div>
    </div>

    <div class="d-flex align-items-center justify-content-center mt-5">
      <div class="container" id="news-section">
        <div class="row gx-4 gy-4" id="news-container" style="min-height: 400px;">
          <!-- News items will be dynamically loaded here -->
        </div>

        <!-- Pagination controls -->
        <div class="d-flex justify-content-center my-3" id="pagination">
          <!-- Pagination buttons will be dynamically loaded here -->
        </div>
      </div>
    </div>
  </div>

  <div class="footer bg-scnd px-5 pt-5 mt-5">
    <div class="container">
      <div class="row pb-5">
        <div class="col-md-4 logo-footer">
          <img class="bg-white border p-2 rounded-circle" src="resources/images/logo.png" alt="Ubuntu Rugby Logo"
            width="160" height="160" />
        </div>
        <div class="col-md-4 item-footer">
          <h5 class="text-uppercase font-impact">Menu</h5>
          <ul class="list-unstyled pt-4">
            <li class="mb-2">
              <a href="index.html" class="link-light">Início</a>
            </li>
            <li class="mb-2">
              <a class="link-light" href='https://forms.gle/ctQpSjTfFam2us2f8' target="_blank"
                rel="noopener noreferrer">
                Inscrições
              </a>
            </li>
            <li class="mb-2">
              <a href="partners.html" class="link-light">Sócios</a>
            </li>
            <li>
              <a href="contacts.html" class="link-light">Contactos</a>
            </li>
          </ul>
        </div>
        <div class="col-md-4 item-footer">
          <h5 class="text-uppercase font-impact">Contactos</h5>
          <ul class="list-unstyled pt-4">
            <li class="mb-3">
              <a class="contact" href="mailto:geral@ubunturugby.pt">
                <i class="bi bi-envelope me-3"></i>
                geral@ubunturugby.pt
              </a>
            </li>
            <li>
              <a class="contact" href="tel:+351932606500">
                <i class="bi bi-telephone me-3"></i>
                (+351) 932 606 500
              </a>
            </li>
          </ul>
        </div>
      </div>
      <div class="text-center pb-5">
        Ubuntu Rugby 2024
        <i class="bi bi-c-circle text-light"></i>
        All rights reserved.
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

  <script type="module">
    const csvFilePath = 'resources/news.csv';

    let newsItems = [];
    let filteredNewsItems = [];

    // Fetch the CSV file
    fetch(csvFilePath)
      .then(response => response.text())
      .then(csvData => {
        Papa.parse(csvData, {
          header: true,
          skipEmptyLines: true,
          delimiter: ";",
          complete: function (results) {
            const data = results.data.sort((a, b) => {
              const dateA = new Date(a['Data'].replace(/(\d{2})\/(\d{2})\/(\d{4})/, "$2/$1/$3"));
              const dateB = new Date(b['Data'].replace(/(\d{2})\/(\d{2})\/(\d{4})/, "$2/$1/$3"));
              return dateB - dateA;
            });
            let idCounter = results.data.length;

            // Iterate over the parsed data
            results.data.forEach(row => {
              // Create the object for each row
              const entry = {
                id: idCounter--,
                title: row['Título'],
                date: row['Data'],
                description: row['Descrição'],
                type: row['Tipo'],
                images: row['Ficheiros'] ? row['Ficheiros'].split(',').length : 0
              };

              // Push the object into the array
              newsItems.push(entry);
            });
            console.log("News items:", newsItems);
            filteredNewsItems = [...newsItems];
            updatePage();
          },
          error: function (error) {
            console.error("Error while parsing:", error.message);
          }
        });
      })
      .catch(error => console.error("Error fetching CSV file:", error));

    let currentPage = 1;
    const itemsPerPage = 3; // Number of items per page

    // Function to filter news items based on search input
    function filterNews() {
      const searchInput = document.getElementById("searchInput").value.toLowerCase();

      // Filter news items by title or description
      filteredNewsItems = newsItems.filter(item =>
        item.title.toLowerCase().includes(searchInput) ||
        item.description.toLowerCase().includes(searchInput) ||
        item.date.toLowerCase().includes(searchInput) ||
        item.type.toLowerCase().includes(searchInput)
      );

      currentPage = 1; // Reset to the first page when filtering
      updatePage();
    }

    document.getElementById('searchInput').addEventListener('input', filterNews);

    // Function to render news items for the current page
    function renderNewsItems(page) {
      const startIndex = (page - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;

      const newsContainer = document.getElementById("news-container");
      newsContainer.innerHTML = ""; // Clear the container

      const paginatedItems = filteredNewsItems.slice(startIndex, endIndex);
      if (paginatedItems.length === 0) {
        newsContainer.innerHTML = "<p class='text-white text-center'>Nenhuma notícia encontrada.</p>";
        return;
      }

      // Create a modal element
      const modalHTML = `
    <div id="imageModal" class="modal fade" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="imageModalLabel">Image Preview</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <img src="" alt="Full-size image" id="modalImage">
          </div>
        </div>
      </div>
    </div>
  `;
      document.body.insertAdjacentHTML("beforeend", modalHTML); // Append modal to the document body

      paginatedItems.forEach((item) => {
        const idx = item.id;
        let carouselIndicators = '', carouselItems = '';
        const titleWithoutSpaces = idx;

        if (item.images > 1) {
          for (let i = 0; i < item.images; i++) {
            const isActive = i === 0 ? 'active' : '';
            carouselIndicators += `
          <button type="button" data-bs-target="#carouselExampleCaptions${titleWithoutSpaces}" data-bs-slide-to="${i}" class="${isActive}" ${i === 0 ? 'aria-current="true"' : ''} aria-label="Slide ${i + 1}"></button>
        `;
            carouselItems += `
          <div class="carousel-item ${isActive}">
            <div class="d-flex justify-content-center">
              <img src="news/not${idx}-${i + 1}.jpg" class="img-fluid news-image" alt="${idx}-${i + 1}" onclick="handleImageClick(event)">
            </div>
          </div>
        `;
          }
        }

        const img = item.images === 0
          ? ''
          : `<img src="news/not${idx}-1.jpg" class="img-fluid news-image" alt="${idx}-1" onclick="handleImageClick(event)">`;

        // HTML for news item card
        const newsHTML = `
      <div class="col-lg-4 col-md-6 col-sm-12 my-3 news-item">
        <h5 class="text-uppercase text-center font-impact">${item.title}</h5>
        <div>
          <div class="carousel-inner mb-3">
            ${item.images > 1 ? `
            <div id="carouselExampleCaptions${titleWithoutSpaces}" class="carousel slide" data-bs-ride="false">
              <div class="carousel-indicators">${carouselIndicators}</div>
              <div class="carousel-inner">${carouselItems}</div>
            </div>
            ` : `
            <div class="d-flex justify-content-center">
              ${img}
            </div>`}
          </div>
        </div>
        <div class="text-justify news-text">
          <small class="text-muted">${item.date}</small><br>
          <small class="news-description">${item.description}</small>
          <span class="load-more text-" style="cursor: pointer; display: none;">Ver Mais...</span>
        </div>
      </div>
    `;
        newsContainer.innerHTML += newsHTML;
      });

      // Truncate descriptions and show "Load More..."
      const descriptions = document.querySelectorAll(".news-description");
      descriptions.forEach((description) => {
        const loadMore = description.nextElementSibling;
        const maxHeight = 110; // Approx. 5 lines of text (adjust based on your CSS)

        if (description.scrollHeight > maxHeight) {
          description.style.maxHeight = `${maxHeight}px`;
          description.style.overflow = "hidden";
          description.style.display = "-webkit-box";
          description.style.webkitBoxOrient = "vertical";
          description.style.webkitLineClamp = 4;

          loadMore.style.display = "inline";
          loadMore.addEventListener("click", () => {
            description.style.maxHeight = "none";
            description.style.overflow = "visible";
            loadMore.style.display = "none";
            description.parentElement.parentElement.style.transition = "height 0.3s ease";
            description.parentElement.parentElement.style.height = `${description.scrollHeight + 320}px`; // Adjust height dynamically
          });
        }
      });
    }

    // Function to render pagination controls with mobile-friendly optimization
    function renderPagination() {
      const paginationContainer = document.getElementById("pagination");
      paginationContainer.innerHTML = ""; // Clear pagination

      const totalPages = Math.ceil(filteredNewsItems.length / itemsPerPage);

      // Create the pagination component using Bootstrap
      const paginationList = document.createElement("ul");
      paginationList.className = "pagination justify-content-center flex-wrap";

      // Previous button
      const prevButton = document.createElement("li");
      prevButton.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
      prevButton.innerHTML = `<a class="page-link text-dark"><</a>`;
      prevButton.addEventListener("click", () => {
        if (currentPage > 1) {
          currentPage--;
          updatePage();
        }
      });
      paginationList.appendChild(prevButton);

      // Dynamic page buttons: Show limited buttons on small screens, and use "..." when necessary
      const maxVisibleButtons = window.innerWidth < 576 ? 3 : 5; // Show 3 buttons on mobile, 5 on larger screens
      const startPage = Math.max(1, currentPage - Math.floor(maxVisibleButtons / 2));
      const endPage = Math.min(totalPages, startPage + maxVisibleButtons - 1);

      if (startPage > 1) {
        const firstPageButton = document.createElement("li");
        firstPageButton.className = `page-item ${1 === currentPage ? 'active' : ''}`;
        firstPageButton.innerHTML = `<a class="page-link text-dark">1</a>`;
        firstPageButton.addEventListener("click", () => {
          currentPage = 1;
          updatePage();
        });
        paginationList.appendChild(firstPageButton);

        if (startPage > 2) {
          const ellipsis = document.createElement("li");
          ellipsis.className = "page-item disabled";
          ellipsis.innerHTML = `<span class="page-link text-dark">...</span>`;
          paginationList.appendChild(ellipsis);
        }
      }

      for (let i = startPage; i <= endPage; i++) {
        const pageButton = document.createElement("li");
        pageButton.className = `page-item ${i === currentPage ? 'active' : ''}`;
        pageButton.innerHTML = `<a class="page-link text-dark">${i}</a>`;
        pageButton.addEventListener("click", () => {
          currentPage = i;
          updatePage();
        });
        paginationList.appendChild(pageButton);
      }

      if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
          const ellipsis = document.createElement("li");
          ellipsis.className = "page-item disabled";
          ellipsis.innerHTML = `<span class="page-link text-dark">...</span>`;
          paginationList.appendChild(ellipsis);
        }

        const lastPageButton = document.createElement("li");
        lastPageButton.className = `page-item ${totalPages === currentPage ? 'active' : ''}`;
        lastPageButton.innerHTML = `<a class="page-link text-dark">${totalPages}</a>`;
        lastPageButton.addEventListener("click", () => {
          currentPage = totalPages;
          updatePage();
        });
        paginationList.appendChild(lastPageButton);
      }

      // Next button
      const nextButton = document.createElement("li");
      nextButton.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
      nextButton.innerHTML = `<a class="page-link text-dark">></a>`;
      nextButton.addEventListener("click", () => {
        if (currentPage < totalPages) {
          currentPage++;
          updatePage();
        }
      });
      paginationList.appendChild(nextButton);

      paginationContainer.appendChild(paginationList);
    }

    // Update the page content and scroll to top of the news section
    function updatePage() {
      renderNewsItems(currentPage);
      renderPagination();
    }

    // Initialize the first page
    document.addEventListener("DOMContentLoaded", () => {
      updatePage();
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
    crossorigin="anonymous"></script>

  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

  <script>
    AOS.init();
  </script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-analytics.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAoa3jKyoHLP2uXtkIYZSmk3UbwTkKDifU",
      authDomain: "ubuntu-rugby.firebaseapp.com",
      projectId: "ubuntu-rugby",
      storageBucket: "ubuntu-rugby.appspot.com",
      messagingSenderId: "840013360731",
      appId: "1:840013360731:web:ab6171d67e814b0e6d197e",
      measurementId: "G-Q42T9Z76XB"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
  </script>
</body>

</html>